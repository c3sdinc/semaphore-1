---
- hosts: all
  become: true
  pre_tasks:

  - name: install updates for Debian
    tags: always
    ansible.builtin.apt:
      update_cache: yes
      install_recommends: yes
      force_apt_get: yes
      upgrade: yes
      autoclean: yes
      autoremove: yes
    when: ansible_distribution == "Debian"

- name: Upgrade all packages on servers
  apt:
    upgrade: dist
    force_apt_get: yes
    
- name: Check if a reboot is needed on all servers
  register: reboot_required_file
  stat:
    path: /var/run/reboot-required
    get_md5: no
